<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<title>TSL - Cek Tarif</title>

<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
}

header {
  background: #0b3d1b;
  color: white;
  padding: 14px 20px;
  font-size: 18px;
  font-weight: bold;
}

.container {
  display: flex;
  height: calc(100vh - 52px);
}

.form {
  width: 360px;
  padding: 15px;
  background: #f5f5f5;
}

.form label {
  font-weight: bold;
  display: block;
  margin-top: 12px;
}

.form input, .form select {
  width: 100%;
  padding: 8px;
  margin-top: 4px;
}

.suggestions {
  background: white;
  border: 1px solid #ccc;
  max-height: 160px;
  overflow-y: auto;
  position: absolute;
  width: 330px;
  z-index: 1000;
}

.suggestions div {
  padding: 8px;
  cursor: pointer;
}

.suggestions div:hover {
  background: #eee;
}

button {
  margin-top: 15px;
  width: 100%;
  padding: 10px;
  background: #0b3d1b;
  color: white;
  border: none;
  cursor: pointer;
}

#map {
  flex: 1;
}
</style>
</head>

<body>

<header>ðŸšš PT TAL SARANA LOGISTIK â€“ Cek Tarif</header>

<div class="container">
  <div class="form">
    <label>Lokasi Jemput</label>
    <input id="pickup" placeholder="Contoh: Jakarta" autocomplete="off" />
    <div id="pickupList" class="suggestions"></div>

    <label>Lokasi Tujuan</label>
    <input id="dropoff" placeholder="Contoh: Tangerang" autocomplete="off" />
    <div id="dropoffList" class="suggestions"></div>

    <label>Jenis Kendaraan</label>
    <select id="vehicle">
      <option value="5000">CDD</option>
      <option value="7000">Fuso</option>
      <option value="9000">Wingbox</option>
    </select>

    <button onclick="hitung()">Hitung Estimasi</button>

    <p id="hasil"></p>
  </div>

  <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
const map = L.map("map").setView([-6.2, 106.8], 8);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  attribution: "Â© OpenStreetMap"
}).addTo(map);

let pickupData = null;
let dropoffData = null;
let marker1 = null;
let marker2 = null;

function setupAutocomplete(inputId, listId, callback) {
  const input = document.getElementById(inputId);
  const list = document.getElementById(listId);

  input.addEventListener("input", async () => {
    const q = input.value;
    if (q.length < 3) {
      list.innerHTML = "";
      return;
    }

    const res = await fetch(
      `https://nominatim.openstreetmap.org/search?format=json&q=${q}&limit=5`
    );
    const data = await res.json();

    list.innerHTML = "";
    data.forEach(item => {
      const div = document.createElement("div");
      div.textContent = item.display_name;
      div.onclick = () => {
        input.value = item.display_name;
        list.innerHTML = "";
        callback(item);
      };
      list.appendChild(div);
    });
  });
}

setupAutocomplete("pickup", "pickupList", data => {
  pickupData = data;
  if (marker1) map.removeLayer(marker1);
  marker1 = L.marker([data.lat, data.lon]).addTo(map);
  map.setView([data.lat, data.lon], 10);
});

setupAutocomplete("dropoff", "dropoffList", data => {
  dropoffData = data;
  if (marker2) map.removeLayer(marker2);
  marker2 = L.marker([data.lat, data.lon]).addTo(map);
  map.setView([data.lat, data.lon], 10);
});

function hitung() {
  if (!pickupData || !dropoffData) {
    alert("Pilih lokasi dari dropdown terlebih dahulu");
    return;
  }

  const R = 6371;
  const dLat = (dropoffData.lat - pickupData.lat) * Math.PI / 180;
  const dLon = (dropoffData.lon - pickupData.lon) * Math.PI / 180;

  const a =
    Math.sin(dLat/2) * Math.sin(dLat/2) +
    Math.cos(pickupData.lat * Math.PI/180) *
    Math.cos(dropoffData.lat * Math.PI/180) *
    Math.sin(dLon/2) * Math.sin(dLon/2);

  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  const distance = R * c;

  const rate = document.getElementById("vehicle").value;
  const price = Math.round(distance * rate);

  document.getElementById("hasil").innerHTML =
    `Jarak: ${distance.toFixed(1)} km<br>Estimasi Harga: Rp ${price.toLocaleString("id-ID")}`;
}
</script>

</body>
</html>
