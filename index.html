<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Cek Tarif | PT TAL SARANA LOGISTIK</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
:root{
    --green:#2e9f42;
    --dark:#1f2937;
}
body{
    margin:0;
    font-family:Segoe UI,Arial;
    background:#f3f6f4;
}
header{
    background:var(--green);
    color:#fff;
    padding:14px 20px;
    display:flex;
    align-items:center;
    justify-content:space-between;
}
header strong{font-size:18px}
header a{
    color:#fff;
    text-decoration:none;
    background:#1ebe57;
    padding:8px 12px;
    border-radius:6px;
    font-size:14px;
}
.main{
    display:flex;
    height:calc(100vh - 60px);
}
.form{
    width:420px;
    background:#fff;
    padding:18px;
    box-shadow:2px 0 10px rgba(0,0,0,.08);
    overflow:auto;
}
label{
    font-weight:600;
    margin-top:12px;
    display:block;
}
input,select{
    width:100%;
    padding:10px;
    margin-top:6px;
    border-radius:6px;
    border:1px solid #ccc;
}
button{
    width:100%;
    margin-top:16px;
    padding:12px;
    background:var(--green);
    color:#fff;
    border:none;
    border-radius:8px;
    font-size:16px;
    cursor:pointer;
}
button:hover{background:#248a37}
.suggest{
    position:relative;
    background:#fff;
    border:1px solid #ddd;
    border-radius:6px;
    max-height:180px;
    overflow:auto;
    z-index:999;
}
.suggest div{
    padding:8px;
    cursor:pointer;
    border-bottom:1px solid #eee;
}
.suggest div:hover{background:#f0f7ee}
.result{
    margin-top:16px;
    background:#f9fafb;
    padding:14px;
    border-radius:10px;
    font-size:14px;
}
.result b{font-size:16px}
small{color:#555}
#map{flex:1}
</style>
</head>

<body>

<header>
    <strong>üöö PT TAL SARANA LOGISTIK</strong>
    <a href="https://wa.me/628131342202" target="_blank">üí¨ Chat Admin</a>
</header>

<div class="main">

<div class="form">

<label>Lokasi Jemput</label>
<input id="from" placeholder="Contoh: Gudang, Jalan Raya, Tangerang">
<div id="fromSuggest" class="suggest"></div>

<label>Lokasi Tujuan</label>
<input id="to" placeholder="Contoh: Jakarta Barat">
<div id="toSuggest" class="suggest"></div>

<label>Jenis Kendaraan</label>
<select id="kendaraan">
    <option value="8500">Pickup / Engkel</option>
    <option value="11000">CDD</option>
    <option value="14000">Fuso</option>
    <option value="18000">Tronton</option>
</select>

<button onclick="hitung()">Hitung Estimasi</button>

<div id="hasil" class="result">
<small>Masukkan lokasi jemput & tujuan</small>
</div>

</div>

<div id="map"></div>

</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
const CHARGE_PP = 50000;
const WA = "628131342202";

const map = L.map('map').setView([-6.2,106.8],10);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

let fromMarker,toMarker,line;
let fromLatLng,toLatLng;

async function search(q){
    if(q.length<3) return [];
    const r=await fetch(`https://photon.komoot.io/api/?q=${encodeURIComponent(q)}&limit=6&lang=id`);
    const d=await r.json();
    return d.features||[];
}

function auto(inputId,suggestId,type){
    const i=document.getElementById(inputId);
    const s=document.getElementById(suggestId);

    i.addEventListener("input",async()=>{
        s.innerHTML="";
        const r=await search(i.value);
        r.forEach(p=>{
            const d=document.createElement("div");
            d.innerText=p.properties.name||p.properties.street||"Lokasi";
            d.onclick=()=>{
                i.value=d.innerText;
                s.innerHTML="";
                const ll=[p.geometry.coordinates[1],p.geometry.coordinates[0]];
                if(type==="from"){
                    if(fromMarker)map.removeLayer(fromMarker);
                    fromLatLng=ll;
                    fromMarker=L.marker(ll).addTo(map).bindPopup("Jemput");
                }else{
                    if(toMarker)map.removeLayer(toMarker);
                    toLatLng=ll;
                    toMarker=L.marker(ll).addTo(map).bindPopup("Tujuan");
                }
                draw();
            }
            s.appendChild(d);
        });
    });
}

function draw(){
    if(fromLatLng&&toLatLng){
        if(line)map.removeLayer(line);
        line=L.polyline([fromLatLng,toLatLng],{color:"green",dashArray:"6"}).addTo(map);
        map.fitBounds(line.getBounds());
    }
}

function hitung(){
    if(!fromLatLng||!toLatLng){
        alert("Lengkapi lokasi terlebih dahulu");
        return;
    }
    const jarak=map.distance(fromLatLng,toLatLng)/1000;
    const tarif=document.getElementById("kendaraan").value;
    const waktu=jarak/40*60;
    const total=(jarak*tarif)+CHARGE_PP;

    document.getElementById("hasil").innerHTML=`
    <b>Estimasi Pengiriman</b><br><br>
    üìè Jarak: ${jarak.toFixed(1)} km<br>
    ‚è±Ô∏è Estimasi Waktu: ${Math.round(waktu)} menit<br>
    üöö Tarif/km: Rp ${Number(tarif).toLocaleString()}<br>
    üîÅ Charge PP: Rp ${CHARGE_PP.toLocaleString()}<br>
    <hr>
    <b>Total Estimasi: Rp ${Math.round(total).toLocaleString()}</b><br><br>
    <a href="https://wa.me/${WA}?text=Halo%20Admin%2C%20saya%20ingin%20order%20pengiriman"
    target="_blank">üí¨ Lanjut Order via WhatsApp</a><br><br>
    <small>*Harga estimasi, dapat berubah sesuai kondisi lapangan</small>
    `;
}

auto("from","fromSuggest","from");
auto("to","toSuggest","to");
</script>

</body>
</html>
